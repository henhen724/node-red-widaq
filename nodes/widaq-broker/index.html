<script type="text/javascript">
    RED.nodes.registerType('widaq-broker', {
        category: 'config',
        credentials: {
            username: { type: "text" },
            password: { type: "password" }
        },
        defaults: {
            username: { value: "" },
            password: { value: "" },
            name: { value: "" },
            host: { value: "localhost", required: true },
            port: { value: 1883, required: true, validate: RED.validators.number() },
            allowRemoteTerminalAccess: { value: true },
        },
        label: function () {
            return this.name || "Wi DAQ mqtt://" + this.host + ":" + this.port;
        },
        oneditprepare: function () {
            const tabs = RED.tabs.create({
                id: "node-config-widaq-broker-tabs",
                onchange: function (tab) {
                    $("#node-config-widaq-broker-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "widaq-broker-tab-connection",
                label: "Connection"
            });
            tabs.addTab({
                id: "widaq-broker-tab-security",
                label: "Security"
            });
        }
    });
</script>

<script type="text/html" data-template-name="widaq-broker">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name"/>
    </div>
    <div class="form-row">
        <ul style="min-width: 600px; margin-bottom: 20px;" id="node-config-widaq-broker-tabs"></ul>
    </div>
    <div id="node-config-widaq-broker-tabs-content" style="min-height:150px;">
        <div id="widaq-broker-tab-connection" style="display:none">
            <div class="form-row">
                <label for="node-config-input-host"><i class="fa fa-globe"></i> Host</label>
                <input type="text" id="node-config-input-host" style="width:40%;"/>
                <label for="node-config-input-port" style="margin-left:20px; width:43px;"> Port</label>
                <input type="text" id="node-config-input-port" style="width:55px"/>
            </div>
        </div>
        <div id="widaq-broker-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
                <input type="text" id="node-config-input-username"/>
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> Password</label>
                <input type="password" id="node-config-input-password"/>
            </div>
        </div>
        <div id="widaq-broker-tab-messages" style="display:none">
        </div>
    </div>
</script>

<script type="text/html" data-help-name="widaq-broker">
    <p>Configuration for a connection to an MQTT broker.</p>

    <p>This configuration will create a single connection to the broker which can then be reused by MQTT In and MQTT Out nodes.</p>

    <p>The node will generate a random Client ID if one is not set and the node is configured to use a Clean Session connection. If a Client ID is set, it must be unique to the broker you are connecting to.</p>

    <h4>Birth Message</h4>
    <p>This is a message that will be published on the configured topic whenever the connection is established.</p>

    <h4>Close Message</h4>
    <p>This is a message that will be published on the configured topic before the connection is closed normally, either by re-deploying the node, or by shutting down.</p>

    <h4>Will Message</h4>
    <p>This is a message that will be published by the broker in the event the node unexpectedly loses its connection.</p>

    <h4>WebSockets</h4>
    <p>The node can be configured to use a WebSocket connection. To do so, the Server field should be configured with a full URI for the connection. For example:</p>

    ws://example.com:4000/mqtt
</script>